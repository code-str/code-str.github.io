<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Code-Str转换小工具</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .container { background: #f5f5f5; padding: 2rem; border-radius: 8px; }
        h1 { color: #333; text-align: center; }
        .input-group { margin: 1rem 0; }
        label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        input[type="text"], textarea { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical; }
        textarea { min-height: 100px; }
        button { background: #007bff; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 4px; cursor: pointer; font-size: 1rem; }
        button:hover { background: #0056b3; }
        .result { margin-top: 1.5rem; padding: 1rem; background: white; border-radius: 4px; border: 1px solid #eee; }
        .result h3 { margin-top: 0; color: #333; }
        .output { font-family: monospace; font-size: 1rem; white-space: pre-wrap; word-break: break-all; }
        .tip { font-size: 0.9rem; color: #666; margin-top: 0.3rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Code-Str转换小工具</h1>
        
        <div class="input-group">
            <label for="referInput">逻辑字符</label>
            <input type="text" id="referInput" value="" placeholder="逻辑字符">
        </div>
        
        <div class="input-group">
            <label for="wordsInput">输入字符串</label>
            <input type="text" id="wordsInput" value="" placeholder="请输入类似ab-010203的字符串">
        </div>
        
        <button onclick="begin()">执行转换</button>
        
        <div class="result">
            <h3>转换结果</h3>
            <p class="output" id="logResult"></p>
        </div>
    </div>

    <script>
        /**
         * 主方法：对应OC中的begin方法
         */
        function begin() {
            const logElement = document.getElementById('logResult');
            logElement.textContent = ''; // 清空日志

            // 获取用户输入的参考字符串
            const referString = document.getElementById('referInput').value.trim();
            if (!referString) {
                log('错误：逻辑字符不能为空');
                return;
            }

            const words = document.getElementById('wordsInput').value.trim();
            const array = words.split('-');

            if (array.length === 2) {
                // 处理第一个部分（字母转位置）
                let indexwords = '';
                const indexWord = array[0];
                for (let i = 0; i < indexWord.length; i++) {
                    const letter = indexWord.charAt(i);
                    const index = changeToNewWordWithReferString(referString, letter);
                    indexwords += index;
                }

                // 处理第二个部分（位置转字母）
                let strwords = '';
                const codeWord = array[1];
                let start = 0;
                const codeLength = codeWord.length;
                // 确保字符串长度是偶数（每两位一组）
                if (codeLength % 2 !== 0) {
                    log('错误：第二部分字符串长度不是偶数，格式不正确');
                    return;
                }

                for (let i = 0; i < codeLength / 2; i++) {
                    const code = codeWord.substring(start, start + 2);
                    const word = returnIndexStringWithReferString(referString, parseInt(code));
                    strwords += word;
                    start += 2;
                }

                const finishword = `${indexwords}-${strwords}`;
                log(`${finishword}`);
            } else {
                log('字符串格式不正确');
            }
        }

        /**
         * 对应OC中的changeToNewWordWithReferString:word:
         * 根据参考字符串，将单词（字母）转为位置字符串（补0）
         */
        function changeToNewWordWithReferString(referString, word) {
            let newWord = '';
            for (let i = 0; i < word.length; i++) {
                const letter = word.charAt(i);
                const index = returnIndexWithReferString(referString, letter);
                // 小于10补0，转为两位字符串
                newWord += index < 10 ? `0${index}` : `${index}`;
            }
            return newWord;
        }

        /**
         * 对应OC中的returnIndexWithReferString:charToFind:
         * 根据参考字符串，查找字符的位置（从1开始计数）
         */
        function returnIndexWithReferString(referString, charToFind) {
            const index = referString.indexOf(charToFind);
            // 找不到返回0，找到返回位置+1（与OC逻辑一致）
            return index !== -1 ? index + 1 : 0;
        }

        /**
         * 对应OC中的returnIndexStringWithReferString:index:
         * 根据参考字符串，将位置转为对应的字符（位置从1开始）
         */
        function returnIndexStringWithReferString(referString, index) {
            // 验证索引有效性
            if (index < 1 || index > referString.length) {
                return '';
            }
            return referString.charAt(index - 1);
        }

        /**
         * 日志输出辅助函数
         */
        function log(message) {
            const logElement = document.getElementById('logResult');
            logElement.textContent += `${message}\n`;
            console.log(message); // 同时输出到控制台
        }
    </script>
</body>
</html>
